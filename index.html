const symbolsConfig = [
            { symbol: "🍒", value: 1, rarity: 40 },
            { symbol: "🍋", value: 2, rarity: 35 },
            { symbol: "🍎", value: 0, rarity: 75 },
            { symbol: "🍊", value: 3, rarity: 25 },
            { symbol: "🔔", value: 5, rarity: 15 },
            { symbol: "⭐", value: 8, rarity: 8 },
            { symbol: "💎", value: 12, rarity: 2 }
        ];

        const slots = [document.getElementById("slot1"), document.getElementById("slot2"), document.getElementById("slot3")];
        const resultEl = document.getElementById("result");
        const creditDisplay = document.getElementById("creditAmount");
        const popup = document.getElementById("creditPopup");
        const spinSound = document.getElementById("spinSound");
        const winSound = document.getElementById("winSound");
        const loseSound = document.getElementById("loseSound");
        const spinBtn = document.getElementById("spinButton");
        const adBtn = document.getElementById("adButton");
        const infoBtn = document.getElementById("infoButton");
        const symbolValuesDiv = document.getElementById("symbolValues");

        let credits = 10;
        const spinCost = 1;
        const baseCreditValue = 0.01358; // Nouvelle valeur du coin
        let currentCreditValue = baseCreditValue;
        let isSpinning = false;

        // Créer une liste pondérée de symboles basée sur la rareté
        let weightedSymbols = [];
        symbolsConfig.forEach(item => {
            for (let i = 0; i < item.rarity; i++) {
                weightedSymbols.push(item.symbol);
            }
        });

        function updateCredits() {
            creditDisplay.textContent = `${credits} 🪙`;
            popup.textContent = `${credits} 🪙 = ${(credits * currentCreditValue).toFixed(4)} €`;
            spinBtn.disabled = credits < spinCost || isSpinning;
            adBtn.style.display = credits < spinCost ? 'block' : 'none';
        }

        function toggleValuePopup() {
            popup.style.display = popup.style.display === 'block' ? 'none' : 'block';
        }

        function toggleSymbolValues() {
            symbolValuesDiv.style.display = symbolValuesDiv.style.display === 'block' ? 'none' : 'block';
        }

        function spin() {
            if (credits < spinCost || isSpinning) return;

            isSpinning = true;
            credits -= spinCost;
            resultEl.textContent = "Tirage en cours... 🎲";
            spinSound.play();
            spinBtn.disabled = true; // Désactiver pendant le spin

            slots.forEach(slot => slot.classList.add("spinning"));

            setTimeout(() => {
                slots.forEach(slot => slot.classList.remove("spinning"));

                const result = [];
                let winAmount = 0;
                for (let i = 0; i < 3; i++) {
                    const randomSymbol = weightedSymbols[Math.floor(Math.random() * weightedSymbols.length)];
                    slots[i].textContent = randomSymbol; // Toujours afficher un emoji
                    result.push(randomSymbol);
                }

                if (result[0] === result[1] && result[1] === result[2] && result[0] !== "🍎") {
                    // Jackpot (pas de triple pomme)
                    const winningSymbolConfig = symbolsConfig.find(item => item.symbol === result[0]);
                    if (winningSymbolConfig) {
                        winAmount = winningSymbolConfig.value * 10;
                        resultEl.textContent = `🎉 TRIPLE ${result[0]} ! Tu gagnes +${winAmount} 🪙 !`;
                        winSound.play();
                    } else {
                        resultEl.textContent = `❌ Rien gagné.`;
                        loseSound.play();
                    }
                } else if ((result[0] === result[1] || result[1] === result[2] || result[0] === result[2]) && !result.includes("🍎")) {
                    // Double (pas de double pomme)
                    const matchingSymbol = result[0] === result[1] ? result[0] : (result[1] === result[2] ? result[1] : (result[0] === result[2] ? result[0] : null));
                    if (matchingSymbol) {
                        const matchingSymbolConfig = symbolsConfig.find(item => item.symbol === matchingSymbol);
                        if (matchingSymbolConfig) {
                            winAmount = matchingSymbolConfig.value * 2;
                            resultEl.textContent = `✨ DOUBLE ${matchingSymbol} ! Tu gagnes +${winAmount} 🪙`;
                            winSound.play();
                        } else {
                            resultEl.textContent = `❌ Rien gagné.`;
                            loseSound.play();
                        }
                    } else {
                        resultEl.textContent = `❌ Rien gagné.`;
                        loseSound.play();
                    }
                } else {
                    resultEl.textContent = `❌ Rien gagné.`;
                    loseSound.play();
                }

                credits += winAmount;
                isSpinning = false;
                updateCredits(); // Mise à jour de l'affichage
            }, 1500);
        }

        function watchAd() {
            // Redirection vers le site de publicité
            window.location.href = "http://eraz.ovh";
            // Pour une implémentation réelle, il faudrait gérer le retour et la récompense côté serveur.
        }

        // Remplir le popup des valeurs des symboles au chargement
        symbolValuesDiv.innerHTML = "<h3>Valeurs des Symboles et Gains:</h3>"; // Réinitialiser le contenu
        symbolsConfig.forEach(item => {
            const symbolInfo = document.createElement('p');
            const tripleWin = item.symbol === "🍎" ? "0" : `+${item.value * 10}`;
            const doubleWin = item.symbol === "🍎" ? "0" : `+${item.value * 2}`;
            symbolInfo.innerHTML = `<strong>${item.symbol}</strong> : ${item.value} 🪙<br>
                                   Triple: ${tripleWin} 🪙<br>
                                   Double: ${doubleWin} 🪙<br>
                                   (Rareté: ${item.rarity})`;
            symbolValuesDiv.appendChild(symbolInfo);
        });
        // Ajouter une mention spéciale pour la pomme
        const appleInfo = document.createElement('p');
        appleInfo.innerHTML = `<strong>🍎 Pomme</strong> : 0 🪙<br>(Rareté: ${symbolsConfig.find(s => s.symbol === "🍎").rarity})`;
        symbolValuesDiv.appendChild(appleInfo);

        // Initialisation de la valeur en euros
        popup.textContent = `${credits} 🪙 = ${(credits * baseCreditValue).toFixed(4)} €`;
        updateCredits(); // Initialiser l'affichage
    </script>
</body>
</html>
